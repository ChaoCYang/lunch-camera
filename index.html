<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç«é‹æ™ºèƒ½æ¨è–¦ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-red-50 to-orange-50 min-h-screen">
    <div class="max-w-4xl mx-auto p-6">
        <!-- æ¨™é¡Œ -->
        <div class="text-center mb-8">
            <div class="flex items-center justify-center gap-3 mb-4">
                <svg class="w-10 h-10 text-red-500" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M13.5.67s.74 2.65.74 4.8c0 2.06-1.35 3.73-3.41 3.73-2.07 0-3.63-1.67-3.63-3.73l.03-.36C5.21 7.51 4 10.62 4 14c0 4.42 3.58 8 8 8s8-3.58 8-8C20 8.61 17.41 3.8 13.5.67zM11.71 19c-1.78 0-3.22-1.4-3.22-3.14 0-1.62 1.05-2.76 2.81-3.12 1.77-.36 3.6-1.21 4.62-2.58.39 1.29.59 2.65.59 4.04 0 2.65-2.15 4.8-4.8 4.8z"/>
                </svg>
                <h1 class="text-4xl font-bold text-gray-800">ç«é‹æ™ºèƒ½æ¨è–¦</h1>
                <svg class="w-10 h-10 text-red-500" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M13.5.67s.74 2.65.74 4.8c0 2.06-1.35 3.73-3.41 3.73-2.07 0-3.63-1.67-3.63-3.73l.03-.36C5.21 7.51 4 10.62 4 14c0 4.42 3.58 8 8 8s8-3.58 8-8C20 8.61 17.41 3.8 13.5.67zM11.71 19c-1.78 0-3.22-1.4-3.22-3.14 0-1.62 1.05-2.76 2.81-3.12 1.77-.36 3.6-1.21 4.62-2.58.39 1.29.59 2.65.59 4.04 0 2.65-2.15 4.8-4.8 4.8z"/>
                </svg>
            </div>
            <p class="text-gray-600">å‘Šè¨´æˆ‘å€‘æ‚¨æƒ³åƒä»€éº¼ï¼ŒAI ç‚ºæ‚¨æ¨è–¦æœ€é©åˆçš„èœå“</p>
            <button onclick="toggleSettings()" class="mt-3 text-sm text-gray-500 hover:text-gray-700 flex items-center gap-1 mx-auto">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
                <span id="apiKeyStatus">è¨­å®š API Key</span>
            </button>
        </div>

        <!-- API Key è¨­å®š -->
        <div id="settingsPanel" class="bg-white rounded-2xl shadow-lg p-6 mb-6 hidden">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">Gemini API Key è¨­å®š</h3>
            <p class="text-sm text-gray-600 mb-3">
                è«‹åˆ° <a href="https://makersuite.google.com/app/apikey" target="_blank" rel="noopener noreferrer" class="text-blue-500 hover:underline">Google AI Studio</a> å–å¾—å…è²» API Key
            </p>
            <div class="flex gap-3">
                <input
                    type="password"
                    id="apiKeyInput"
                    placeholder="è¼¸å…¥æ‚¨çš„ Gemini API Key"
                    class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent focus:outline-none"
                />
                <button
                    onclick="saveApiKey()"
                    class="px-6 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors"
                >
                    å„²å­˜
                </button>
            </div>
        </div>

        <!-- è¼¸å…¥å€ -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-3">
                æè¿°æ‚¨æƒ³åƒçš„é£Ÿç‰©ç‰¹æ€§
            </label>
            <div class="flex gap-3">
                <input
                    type="text"
                    id="userInput"
                    placeholder="ä¾‹å¦‚ï¼šæˆ‘æƒ³åƒè¾£çš„ã€æˆ‘æƒ³åƒæ¸…æ·¡å¥åº·çš„ã€æˆ‘æƒ³åƒé«˜ç´šçš„è‚‰é¡..."
                    class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent focus:outline-none"
                    onkeypress="handleKeyPress(event)"
                />
                <button
                    id="searchBtn"
                    onclick="analyzeWithGemini()"
                    class="px-6 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors flex items-center gap-2"
                >
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                    æ¨è–¦èœå“
                </button>
            </div>
            <p id="errorMessage" class="mt-3 text-red-500 text-sm hidden"></p>
        </div>

        <!-- æ¨è–¦çµæœ -->
        <div id="recommendations" class="space-y-4 hidden">
            <h2 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path>
                </svg>
                ç‚ºæ‚¨æ¨è–¦
            </h2>
            <div id="recommendationsList"></div>
        </div>

        <!-- ä½¿ç”¨æç¤º -->
        <div id="usageTips" class="bg-white rounded-xl shadow-md p-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">ğŸ’¡ ä½¿ç”¨æç¤º</h3>
            <ul class="space-y-2 text-gray-600">
                <li>â€¢ æè¿°æ‚¨å–œæ­¡çš„å£å‘³ï¼šè¾£çš„ã€æ¸…æ·¡çš„ã€é®®ç”œçš„</li>
                <li>â€¢ æè¿°é£Ÿæé¡å‹ï¼šè‚‰é¡ã€æµ·é®®ã€è”¬èœ</li>
                <li>â€¢ æè¿°åå¥½ï¼šå¥åº·çš„ã€é«˜ç´šçš„ã€é¤Šç”Ÿçš„</li>
                <li>â€¢ æˆ–ç›´æ¥èªªï¼šæˆ‘æƒ³åƒéº»è¾£çš„ã€æˆ‘æƒ³åƒç‰›è‚‰</li>
            </ul>
        </div>
    </div>

    <script>
        // ç«é‹èœå–®è³‡æ–™åº«
        const menuItems = [
            {
                name: "æ¥µå“å’Œç‰›æ¶®æ¶®é‹",
                category: "è‚‰é¡",
                description: "é ‚ç´šA5å’Œç‰›è–„åˆ‡ï¼Œæ²¹èŠ±è±å¯Œï¼Œå…¥å£å³åŒ–",
                characteristics: ["é«˜ç´š", "æ²¹è„‚è±å¯Œ", "è»Ÿå«©", "ç‰›è‚‰", "å¥¢è¯", "ç´°ç·»"],
                cooking: "æ¶®ç‡™3-5ç§’",
                price: "NT$880"
            },
            {
                name: "éº»è¾£é´¨è¡€è±†è…é‹",
                category: "æ¹¯åº•",
                description: "å››å·éº»è¾£æ¹¯åº•é…å«©æ»‘é´¨è¡€å’Œè±†è…ï¼Œé¦™è¾£éç™®",
                characteristics: ["è¾£", "éº»", "é‡å£å‘³", "åˆºæ¿€", "è±†è£½å“", "å…§è‡Ÿ"],
                cooking: "ç…®3-5åˆ†é˜",
                price: "NT$380"
            },
            {
                name: "æµ·é®®æ‹¼ç›¤",
                category: "æµ·é®®",
                description: "æ–°é®®è‰è¦ã€èŠ±æã€è›¤è £ã€é®®é­šç‰‡ç¶œåˆæ‹¼ç›¤",
                characteristics: ["æµ·é®®", "é®®ç”œ", "æ¸…æ·¡", "å¥åº·", "ä½è„‚", "è›‹ç™½è³ª"],
                cooking: "æ¶®ç‡™è‡³è®Šè‰²",
                price: "NT$580"
            },
            {
                name: "é¤Šç”ŸèŒè‡è”¬èœç›¤",
                category: "è”¬èœ",
                description: "å¤šç¨®è‡é¡æ­é…æ™‚ä»¤è”¬èœï¼Œæ¸…çˆ½å¥åº·",
                characteristics: ["æ¸…æ·¡", "å¥åº·", "ç´ é£Ÿ", "çº–ç¶­", "é¤Šç”Ÿ", "ä½å¡"],
                cooking: "ç…®2-3åˆ†é˜",
                price: "NT$280"
            }
        ];

        // è¼‰å…¥ API Key
        window.onload = function() {
            const savedKey = localStorage.getItem('gemini_api_key');
            if (savedKey) {
                document.getElementById('apiKeyInput').value = savedKey;
                document.getElementById('apiKeyStatus').textContent = 'API Key å·²è¨­å®š';
            }
        };

        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            panel.classList.toggle('hidden');
        }

        function saveApiKey() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            if (apiKey) {
                localStorage.setItem('gemini_api_key', apiKey);
                document.getElementById('apiKeyStatus').textContent = 'API Key å·²è¨­å®š';
                document.getElementById('settingsPanel').classList.add('hidden');
                showError('');
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                analyzeWithGemini();
            }
        }

        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            if (message) {
                errorEl.textContent = message;
                errorEl.classList.remove('hidden');
            } else {
                errorEl.classList.add('hidden');
            }
        }

        function setLoading(isLoading) {
            const btn = document.getElementById('searchBtn');
            if (isLoading) {
                btn.disabled = true;
                btn.classList.add('opacity-50', 'cursor-not-allowed');
                btn.innerHTML = `
                    <svg class="w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                    åˆ†æä¸­
                `;
            } else {
                btn.disabled = false;
                btn.classList.remove('opacity-50', 'cursor-not-allowed');
                btn.innerHTML = `
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                    æ¨è–¦èœå“
                `;
            }
        }

        async function analyzeWithGemini() {
            const userInput = document.getElementById('userInput').value.trim();
            const apiKey = localStorage.getItem('gemini_api_key');

            if (!userInput) {
                showError('è«‹è¼¸å…¥æ‚¨æƒ³åƒçš„é£Ÿç‰©ç‰¹æ€§');
                return;
            }

            if (!apiKey) {
                showError('è«‹å…ˆè¨­å®š Gemini API Key');
                document.getElementById('settingsPanel').classList.remove('hidden');
                return;
            }

            setLoading(true);
            showError('');
            document.getElementById('recommendations').classList.add('hidden');

            try {
                const prompt = `ä½ æ˜¯ä¸€å€‹ç«é‹é¤å»³çš„æ™ºèƒ½æ¨è–¦åŠ©æ‰‹ã€‚

ç”¨æˆ¶æè¿°ï¼šã€Œ${userInput}ã€

é¤å»³èœå–®ï¼š
${menuItems.map((item, idx) => 
  `${idx + 1}. ${item.name} (${item.category})
  æè¿°ï¼š${item.description}
  ç‰¹æ€§ï¼š${item.characteristics.join('ã€')}
  åƒ¹æ ¼ï¼š${item.price}`
).join('\n\n')}

è«‹åˆ†æç”¨æˆ¶çš„æè¿°ï¼Œä¸¦æ¨è–¦æœ€é©åˆçš„èœå“ã€‚è¿”å›JSONæ ¼å¼ï¼š
{
  "recommendations": [
    {
      "itemIndex": èœå“ç´¢å¼•(0-3),
      "matchScore": åŒ¹é…åˆ†æ•¸(0-100),
      "reason": "æ¨è–¦ç†ç”±ï¼ˆç”¨ç¹é«”ä¸­æ–‡ï¼Œ30å­—ä»¥å…§ï¼‰"
    }
  ]
}

è«‹æ¨è–¦1-3é“æœ€åŒ¹é…çš„èœå“ï¼ŒæŒ‰åŒ¹é…åº¦æ’åºã€‚åªè¿”å›JSONï¼Œä¸è¦å…¶ä»–æ–‡å­—ã€‚`;

                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{ text: prompt }]
                            }],
                            generationConfig: {
                                temperature: 0.7,
                                maxOutputTokens: 1000,
                            }
                        })
                    }
                );

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('API éŒ¯èª¤è©³æƒ…:', errorData);
                    throw new Error(`API éŒ¯èª¤: ${errorData.error?.message || 'è«‹æª¢æŸ¥ API Key æ˜¯å¦æ­£ç¢º'}`);
                }

                const data = await response.json();
                
                if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {
                    throw new Error('API è¿”å›æ ¼å¼éŒ¯èª¤');
                }

                const text = data.candidates[0].content.parts[0].text;
                const cleanText = text.replace(/```json|```/g, '').trim();
                const result = JSON.parse(cleanText);

                displayRecommendations(result.recommendations);

            } catch (error) {
                console.error('æ¨è–¦éŒ¯èª¤:', error);
                showError(error.message || 'æ¨è–¦ç³»çµ±æš«æ™‚ç„¡æ³•ä½¿ç”¨ï¼Œè«‹æª¢æŸ¥ API Key æˆ–ç¨å¾Œå†è©¦');
            } finally {
                setLoading(false);
            }
        }

        function displayRecommendations(recommendations) {
            const container = document.getElementById('recommendationsList');
            container.innerHTML = '';

            recommendations.forEach(rec => {
                const item = menuItems[rec.itemIndex];
                const card = document.createElement('div');
                card.className = 'bg-white rounded-xl shadow-md p-6 hover:shadow-lg transition-shadow';
                
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h3 class="text-xl font-bold text-gray-800">${item.name}</h3>
                            <span class="inline-block px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm mt-2">
                                ${item.category}
                            </span>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold text-red-500">${item.price}</div>
                            <div class="text-sm text-gray-500 mt-1">
                                åŒ¹é…åº¦: ${rec.matchScore}%
                            </div>
                        </div>
                    </div>
                    
                    <p class="text-gray-600 mb-3">${item.description}</p>
                    
                    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-3 mb-3">
                        <p class="text-sm text-gray-700">
                            <span class="font-semibold">æ¨è–¦ç†ç”±ï¼š</span>
                            ${rec.reason}
                        </p>
                    </div>

                    <div class="flex flex-wrap gap-2 mb-3">
                        ${item.characteristics.map(char => 
                            `<span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm">${char}</span>`
                        ).join('')}
                    </div>

                    <p class="text-sm text-gray-500">
                        <span class="font-semibold">çƒ¹é£ªå»ºè­°ï¼š</span>
                        ${item.cooking}
                    </p>
                `;
                
                container.appendChild(card);
            });

            document.getElementById('recommendations').classList.remove('hidden');
            document.getElementById('usageTips').classList.add('hidden');
        }
    </script>
</body>
</html>
